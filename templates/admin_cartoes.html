{% extends "base.html" %}
{% block title %}Admin • Cartões de Reconhecimento | FlashPoint{% endblock %}

{% block content %}

<style>
/* ===== HEADER ===== */
.page-header {
    text-align: center;
    margin-top: 20px;
}
.page-header h4 {
    font-weight: 700;
}
.page-header p {
    color: #6c757d;
    margin-bottom: 0;
}

/* ===== CARD PADRÃO ===== */
.card-box {
    background: #fff;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    margin-bottom: 20px;
}

/* ===== LISTA MOBILE ===== */
.usuarios-cards {
    display: grid;
    gap: 14px;
    padding-bottom: 18px;
}

.usuario-card {
    background: #fff;
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    border-left: 4px solid #041955;
}

.usuario-nome {
    font-weight: 700;
    color: #041955;
    margin-bottom: 6px;
}

/* STATUS */
.status {
    font-size: 11px;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 14px;
    display: inline-block;
}
.status-ok {
    background: #e6f7ed;
    color: #1e7e34;
}
.status-bad {
    background: #fdecea;
    color: #c82333;
}

/* ===== DESKTOP ===== */
.table-desktop {
    display: none;
}

@media (min-width: 768px) {
    .usuarios-cards {
        display: none;
    }
    .table-desktop {
        display: block;
    }
}
</style>

<!-- HEADER -->
<div class="page-header">
    <h4 class="text-dark">
        <i class="fa fa-id-card me-2"></i>Tesserini di riconoscimento
    </h4>
    <p>Generazione e gestione dei cartellini</p>
</div>

<hr class="my-4">

{% if usuarios %}

<!-- ===== MOBILE ===== -->
<div class="usuarios-cards">
    {% for u in usuarios %}

    {% set campos = [
        u.nome,
        u.sobrenome,
        u.data_nascimento,
        u.pais,
        u.data_assuncao,
        u.cargo
    ] %}

    {% set completo = campos | select | list | length == 6 %}

    <div class="usuario-card">

        <div class="usuario-nome">
            <i class="fa fa-user me-1"></i>{{ u.nome }} {{ u.sobrenome }}
        </div>

        {% if completo %}
            <span class="status status-ok">
                Profilo completo
            </span>

            <div class="mt-3 d-grid">
                <a href="{{ url_for('gerar_cartao', uid=u.uid) }}"
                   class="btn btn-success">
                    <i class="fa fa-id-card"></i> Genera tesserino
                </a>
            </div>
        {% else %}
            <span class="status status-bad">
                Profilo incompleto
            </span>

            <div class="mt-3 d-grid">
                <button class="btn btn-secondary" disabled>
                    Profilo incompleto
                </button>
            </div>
        {% endif %}

    </div>
    {% endfor %}
</div>

<!-- ===== DESKTOP ===== -->
<div class="table-desktop">
    <table class="table align-middle">
        <thead>
            <tr>
                <th>Utente</th>
                <th>Stato profilo</th>
                <th class="text-center">Azione</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">

            {% for u in usuarios %}

            {% set campos = [
                u.nome,
                u.sobrenome,
                u.data_nascimento,
                u.pais,
                u.data_assuncao,
                u.cargo
            ] %}

            {% set completo = campos | select | list | length == 6 %}

            <tr>
                <td class="fw-bold">
                    {{ u.nome }} {{ u.sobrenome }}
                </td>

                <td>
                    {% if completo %}
                        <span class="status status-ok">
                            Completo
                        </span>
                    {% else %}
                        <span class="status status-bad">
                            Incompleto
                        </span>
                    {% endif %}
                </td>

                <td class="text-center">
                    {% if completo %}
                        <a href="{{ url_for('gerar_cartao', uid=u.uid) }}"
                           class="btn btn-sm btn-primary">
                            <i class="fa fa-id-card"></i>
                        </a>
                    {% else %}
                        <button class="btn btn-sm btn-secondary" disabled>
                            —
                        </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}

        </tbody>
    </table>
</div>

{% else %}
<p class="text-muted text-center mt-4">
    Nessun utente registrato.
</p>
{% endif %}

{% endblock %}
